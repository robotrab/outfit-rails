<% content_for(:head) do %>
  <%= stylesheet_link_tag "jquery.Jcrop.min" %>
<% end %>

<%= image_tag @post.outfit.url(:profile), :id => "cropbox" %>

<%= form_for @post do |form| %>
  <% for attribute in [:crop_x, :crop_y, :crop_w, :crop_h] %>
    <%= form.hidden_field attribute, :id => attribute %>
  <% end %>
  <p><%= form.submit "Crop" %></p>
<% end %>


<% content_for(:footer) do %>
  <%= javascript_include_tag "jquery.Jcrop.min" %>
  <!-- <%= javascript_include_tag "post_crop" %> -->
  <script type="text/javascript">
    $(function(){
      $('#cropbox').Jcrop({
        onChange: update_crop,
        onSelect: update_crop
      });

      function update_crop(coords) {
        var ratio = <%= @post.image_geometry(:original).width %> / <%= @post.image_geometry(:profile).width %>;
        $('#crop_x').val(Math.floor(coords.x * ratio));
        $('#crop_y').val(Math.floor(coords.y * ratio));
        $('#crop_w').val(Math.floor(coords.w * ratio));
        $('#crop_h').val(Math.floor(coords.h * ratio));
      }
    });
  </script>
<% end %>
